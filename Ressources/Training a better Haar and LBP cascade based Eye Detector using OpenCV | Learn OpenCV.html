<!DOCTYPE html>
<html class="js" style="min-height: 100%;" lang="en-US"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><link type="text/css" media="all" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/autoptimize_5b198f149d8c2dc268a0653fa4cb7ab7.css" rel="stylesheet"><title>Training a better Haar and LBP cascade based Eye Detector using OpenCV | Learn OpenCV</title><meta name="description" content="In this tutorial, we show how we trained Haar and LBP cascade based eye detectors that out-perform OpenCV default eye detectors."><meta name="keywords" content="eye detector,haar,lbp"><link rel="canonical" href="https://www.learnopencv.com/training-better-haar-lbp-cascade-eye-detector-opencv/"><link rel="amphtml" href="https://www.learnopencv.com/training-better-haar-lbp-cascade-eye-detector-opencv/amp/?fbclid=IwAR0UGDME193QW8-mY9F4szkgJsRX-qXEphu8T7M5DWPT-lFworRIYHujsXc"><link rel="dns-prefetch" href="https://fonts.googleapis.com/"><link rel="dns-prefetch" href="https://maxcdn.bootstrapcdn.com/"><link rel="dns-prefetch" href="https://s.w.org/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Feed" href="https://www.learnopencv.com/feed/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Comments Feed" href="https://www.learnopencv.com/comments/feed/"><link rel="alternate" type="application/rss+xml" title="Learn OpenCV » Training a better Haar and LBP cascade based Eye Detector using OpenCV Comments Feed" href="https://www.learnopencv.com/training-better-haar-lbp-cascade-eye-detector-opencv/feed/"> <script type="text/javascript" async="" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/analytics.js"></script><script async="" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/fbevents.js"></script><script type="text/javascript">window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/11\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/www.learnopencv.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.9"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55358,56760,9792,65039],[55358,56760,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);</script><script src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/wp-emoji-release.js" type="text/javascript" defer="defer"></script> <link rel="stylesheet" id="google-fonts-css" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/css.css" type="text/css" media="all"><link rel="stylesheet" id="dashicons-css" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/dashicons.css" type="text/css" media="all"><link rel="stylesheet" id="font-awesome-css" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/font-awesome.css" type="text/css" media="all"> <script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/jquery.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/jquery-migrate.js"></script> <!--[if lt IE 9]> <script type='text/javascript' src='https://www.learnopencv.com/wp-content/themes/genesis/lib/js/html5shiv.min.js?ver=3.7.3'></script> <![endif]--> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/global.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/wp-quicklatex-frontend.js"></script> <link rel="https://api.w.org/" href="https://www.learnopencv.com/wp-json/"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://www.learnopencv.com/xmlrpc.php?rsd"><link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://www.learnopencv.com/wp-includes/wlwmanifest.xml"><link rel="prev" title="Deep Learning Book Gift Recipients" href="https://www.learnopencv.com/deep-learning-book-gift-recipients/"><link rel="next" title="Handwritten Digits Classification : An OpenCV ( C++ / Python ) Tutorial" href="https://www.learnopencv.com/handwritten-digits-classification-an-opencv-c-python-tutorial/"><link rel="shortlink" href="https://www.learnopencv.com/?p=3370"><link rel="alternate" type="application/json+oembed" href="https://www.learnopencv.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.learnopencv.com%2Ftraining-better-haar-lbp-cascade-eye-detector-opencv%2F"><link rel="alternate" type="text/xml+oembed" href="https://www.learnopencv.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fwww.learnopencv.com%2Ftraining-better-haar-lbp-cascade-eye-detector-opencv%2F&amp;format=xml">  <script async="" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/js.js"></script> <script>window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-50426860-2');</script>  <script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;
n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,
document,'script','https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '193036094536652'); // Insert your pixel ID here.
fbq('track', 'PageView');</script> <noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=193036094536652&ev=PageView&noscript=1"
/></noscript><link rel="pingback" href="https://www.learnopencv.com/xmlrpc.php"><link rel="icon" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-32x32.png" sizes="32x32"><link rel="icon" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-192x192.png" sizes="192x192"><link rel="apple-touch-icon-precomposed" href="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-180x180.png"><meta name="msapplication-TileImage" content="https://www.learnopencv.com/wp-content/uploads/2017/04/cropped-favicon-512x512-270x270.png"><script src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/can-i-show.js"></script><script src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/can-i-show.js"></script><link rel="stylesheet" type="text/css" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/shCore.css"><link rel="stylesheet" type="text/css" href="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/shThemeDefault.css"></head><body data-rsssl="1" class="post-template-default single single-post postid-3370 single-format-standard header-full-width content-sidebar" itemscope="" itemtype="https://schema.org/WebPage"><div class="site-container"><ul class="genesis-skip-link"><li><a href="#genesis-nav-primary" class="screen-reader-shortcut"> Skip to primary navigation</a></li><li><a href="#genesis-content" class="screen-reader-shortcut"> Skip to content</a></li><li><a href="#genesis-sidebar-primary" class="screen-reader-shortcut"> Skip to primary sidebar</a></li></ul><header class="site-header shrink fadeup-effect fadeInUp" itemscope="" itemtype="https://schema.org/WPHeader"><div class="wrap"><div class="title-area"><p class="site-title" itemprop="headline"><a href="https://www.learnopencv.com/">Learn OpenCV</a></p><p class="site-description" itemprop="description">OpenCV examples and tutorials ( C++ / Python )</p></div><nav class="nav-primary" aria-label="Main" itemscope="" itemtype="https://schema.org/SiteNavigationElement" id="genesis-nav-primary"><div class="wrap"><div class="responsive-menu-icon"></div><ul id="menu-top-bar" class="menu genesis-nav-menu menu-primary js-superfish responsive-menu sf-js-enabled sf-arrows" style="touch-action: pan-y;"><li id="menu-item-754" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-754"><a href="https://www.learnopencv.com/" itemprop="url"><span itemprop="name">Home</span></a></li><li id="menu-item-753" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-753"><a href="https://www.learnopencv.com/about/" itemprop="url"><span itemprop="name">About</span></a></li><li id="menu-item-859" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-859"><a href="https://www.learnopencv.com/computer-vision-resources" itemprop="url"><span itemprop="name">Resources</span></a></li><li id="menu-item-4009" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-4009"><a href="https://www.learnopencv.com/computer-vision-machine-learning-artificial-intelligence-consulting/" itemprop="url"><span itemprop="name">AI Consulting</span></a></li><li id="menu-item-4153" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-4153"><a href="http://courses.learnopencv.com/" itemprop="url"><span itemprop="name">Courses</span></a></li></ul></div></nav></div></header><div class="site-inner"><div class="content-sidebar-wrap"><main class="content" id="genesis-content"><article class="post-3370 post type-post status-publish format-standard has-post-thumbnail category-application category-how-to category-object-detection category-performance category-tutorial tag-eye-detector tag-haar tag-lbp entry" itemscope="" itemtype="https://schema.org/CreativeWork"><header class="entry-header"><h1 class="entry-title" itemprop="headline">Training a better Haar and LBP cascade based Eye Detector using OpenCV</h1><p class="entry-meta"><time class="entry-time" itemprop="datePublished" datetime="2017-01-23T10:41:01+00:00">January 23, 2017</time> By <span class="entry-author" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><a href="https://www.learnopencv.com/author/koustubh/" class="entry-author-link" itemprop="url" rel="author"><span class="entry-author-name" itemprop="name">Koustubh Sinhal</span></a></span> <span class="entry-comments-link"><a href="https://www.learnopencv.com/training-better-haar-lbp-cascade-eye-detector-opencv/#comments"><span class="dsq-postid" data-dsqidentifier="3370 https://www.learnopencv.com/?p=3370">36 Comments</span></a></span></p></header><div class="entry-content" itemprop="text"><p><a href="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-using-opencv-haar-cascade.jpg"><img class="aligncenter wp-image-3371 size-medium" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/eye-detection-using-opencv-haar-cascade.jpg" alt="Eye detection using OpenCV" srcset="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-using-opencv-haar-cascade.jpg 1172w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-using-opencv-haar-cascade-300x225.jpg 300w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-using-opencv-haar-cascade-768x576.jpg 768w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-using-opencv-haar-cascade-1024x768.jpg 1024w" sizes="(max-width: 1172px) 100vw, 1172px"></a></p><p>This post is part of a series I am writing on Image Recognition and Object Detection.</p><p>The complete list of tutorials in this series is given below:</p><ol><li><a href="https://www.learnopencv.com/image-recognition-and-object-detection-part1">Image recognition using traditional Computer Vision techniques : Part 1</a></li><li><a href="https://www.learnopencv.com/histogram-of-oriented-gradients/" target="_blank">Histogram of Oriented Gradients</a> : Part 2</li><li><a href="https://www.learnopencv.com/handwritten-digits-classification-an-opencv-c-python-tutorial">Example code for image recognition</a> : Part 3</li><li>Training a better eye detector: Part 4a</li><li>Object detection using traditional Computer Vision techniques : Part 4b</li><li>How to train and test your own OpenCV object detector : Part 5</li><li>Image recognition using Deep Learning : Part 6</li><ul><li><a href="https://www.learnopencv.com/neural-networks-a-30000-feet-view-for-beginners/">Introduction to Neural Networks</a></li><li><a href="https://www.learnopencv.com/understanding-feedforward-neural-networks/">Understanding Feedforward Neural Networks</a></li><li><a href="https://www.learnopencv.com/image-classification-using-convolutional-neural-networks-in-keras/">Image Recognition using Convolutional Neural Networks</a></li></ul><li>Object detection using Deep Learning : Part 7</li></ol><p>Sometimes things work out of the box. At other times, they don’t. Such occasions present an opportunity to get better.</p><p>Object
 detection using Haar feature-based cascade classifiers is more than a 
decade and a half old. OpenCV framework provides a pre-built Haar and 
LBP based cascade classifiers for face and eye detection which are of 
reasonably good quality. However, I had never measured the accuracy of 
these face and eye detectors. So, it was a suprise when I discovered 
that pre-built Haar/LBP cascades have a high false positive rate which 
might make them unsuitable for many use-cases. Fortunately, it is 
possible to train an eye detector with very high accuracy and low false 
positive rates for many cases with OpenCV.</p><p>Of course, for building
 more general object detectors I recommend using Deep Learning. You can 
learn more about it in my previous post <a href="http://cv-tricks.com/artificial-intelligence/object-detection-using-deep-learning-for-advanced-users-part-1/" target="_blank">here</a>.
 In this post, I will describe how our team at Big Vision LLC trained a 
near perfect Haar-based eye-detector for a client. I will also provide 
code and the steps to train a Haar-based object detector.</p><h2>Problem Definition and Challenges</h2><p>Our
 client builds a device that automatically determines the power of the 
corrective lens needed to fix a user’s eyesight. The device is 
ridiculously simple — the user looks into the device for a few seconds 
and out comes the prescription.</p><p>The device needs a very accurate 
eye detector that could be integrated into their system. On their 
dataset, the Haar-based eye detector, that is bundled with OpenCV had an
 accuracy of about 89%. In other words, 11% of the time the eye detector
 failed — either the location of the detected eyes were wrong, or there 
were more than or fewer than two eyes detected. A state of the art 
system deserves much better!</p><p>They were looking for an accuracy of 
95% or higher with a near-zero false positive rate. In addition, speed 
was of the essence and so we wanted a detection time budget of 20 ms or 
less. Finally, they needed to ensure that closed eyes were not detected 
to avoid taking a picture while the user was blinking.</p><p>Using Deep 
Learning on a mobile device was out of the scope for this project. We 
were restricted to using OpenCV and that made the problem challenging.</p><h2>Training a better OpenCV Eye Detector</h2><p>My
 first instinct is always to advise a Deep learning based solution to 
any recognition or detection problem as it’s more accurate. However, 
unlike academic problems, real world problems come with constraints. 
Sometimes the constraints are non-technical. For example, the budget 
allocated to a project can sometimes dictate the choice of technology. 
At other times, the platform, the speed requirements and ease of 
integration with a client’s existing infrastructure guide your choices. 
But, we, like 37-Signals (a.k.a Basecamp) embrace constraints.</p><blockquote><p>Instead
 of freaking out about these constraints, embrace them. Let them guide 
you. Constraints drive innovation and force focus. Instead of trying to 
remove them, use them to your advantage.</p></blockquote><p>So, we got 
down to business and built a kickass eye detector! We can’t share the 
eye detector and we can’t share the training data. But we can tell you 
how we went about the process.</p><h3>Data Collection</h3><p>In the game of AI, data is the King. The organization with the largest dataset and more representative dataset will always win.</p><p>Before
 we begin a project, we always try to get the data right because a 
superior algorithm will never be able to fix a bad data problem. Our 
data collection team collected approximately 1000 images of human eyes. 
We also gathered around 7000 negative images randomly from the internet.</p><h3>First Stab at Training</h3><p>Initial
 training was disappointing. Our eye detector was not better than the 
one bundled with OpenCV. Oops! So much for getting the data right.</p><p>There
 were a lot of suggestions made by the team. Maybe we needed more 
positive examples or maybe optimizing the ratio of positive and negative
 images would work. Should we optimize the hyperparameters? How about 
augmenting the data?</p><h3>Data Augmentation and Hyerparameter Optimizations</h3><p>In
 machine learning, often the thing you need to make a good solution into
 an excellent solution is systematic trial and error. Repeated trials 
and experimentation brings good luck! Bet on getting a head on a single 
coin toss, you will lose 50% of the time. Try two coin tosses times and 
your odds jump to 75%. Try four times and the odds are 93.75%!</p><p>After
 a few iterations of data augmentation, smart approaches to collecting 
and creating negative data we were finally able to make models which 
were far superior that that of OpenCV.</p><p>For data augmentation, we 
flipped the eyes vertically to double the dataset. We considered 
randomly applying color transforms to account for illumination 
variations, but it turned out to be not necessary.</p><p>We had intially
 started with a smaller negative dataset, but because we needed a very 
low false positive rate, we increased the negative set quite a bit.</p><p>The biggest win came when we did <strong>hard negative mining</strong>.
 We noticed that a lot of false positives were detected on the face. 
These regions were extracted and put back in the training set as 
negative examples. This simple trick significantly reduced the false 
positive rate.</p><p>But, was our model better than 95%? The client had 
provided us a test-set of around 600 test images. Now was the time to 
test it.</p><p>When we ran our test scripts for the first time, our 
Haar-based detector was at 97% and LBP was at 94% accuracy. Euphoria! We
 had earned our paycheck.</p><blockquote><p> But we are craftsmen. We try harder. We give our best.</p></blockquote><p>With a few more optimization of hyperparameters, <strong>our Haar detector was more than 99% accurate and LBP was close to 96% accurate</strong>.</p><p>Needless to say, our client was extremely pleased with the results.</p><h2>How to Train an OpenCV Object Detector ?</h2><p>While
 we cannot share the model or the training data because of 
confidentiality agreement with our client, we are happy to share the 
tools you would need to do your own experiments.</p><p>We used the following freely shared collection of utilities, scripts and deployment code to create a quick training module.</p><div class="content-box-blue">The code used in this tutorial can be downloaded <a href="https://github.com/spmallick/opencv-haar-classifier-training">here</a>. To download code used in all other tutorials used this blog please <a href="#download">subscribe</a> to our newsletter.</div><p>The scripts we are sharing assume you have Python, Perl, and OpenCV installed on your Linux/OSX machine.</p><h3>Step 1 : Data Collection</h3><p>Collect images of the object you want to detect, crop them to some fixed aspect ratio and put these images in the <strong>positive_images</strong>
 folder. For example, we collected 1000 images of eyes, cropped them 
into square images and put them in the positive_images directory. 
Similarly, collect a large set of negative examples, crop them in the 
same aspect ratio as the positive samples, and put them in a directory 
named <strong>negative_images</strong>.</p><h3>Step 2 : Create Training Data files</h3><p>You need to create text files <strong>postives.txt</strong> and <strong>negatives.txt</strong> using the commands below:</p><div><div id="highlighter_119154" class="syntaxhighlighter  bash"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash functions">find</code> <code class="bash plain">.</code><code class="bash plain">/negative_images</code> <code class="bash plain">-iname </code><code class="bash string">"*.jpg"</code> <code class="bash plain">&gt; negatives.txt</code></div><div class="line number2 index1 alt1"><code class="bash functions">find</code> <code class="bash plain">.</code><code class="bash plain">/positive_images</code> <code class="bash plain">-iname </code><code class="bash string">"*.jpg"</code> <code class="bash plain">&gt; positives.txt</code></div></div></td></tr></tbody></table></div></div><h3>Step 3: Create Samples</h3><ol><ol><li>Use <strong>createsamples.pl</strong> to create .vec file for each image.<div><div id="highlighter_423416" class="syntaxhighlighter  bash"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">perl bin</code><code class="bash plain">/createsamples</code><code class="bash plain">.pl positives.txt negatives.txt samples 5000 </code><code class="bash string">"opencv_createsamples -bgcolor 0 -bgthresh 0 -maxxangle 1.1 -maxyangle 1.1 maxzangle 0.5 -maxidev 40 -w 40 -h 40"</code></div></div></td></tr></tbody></table></div></div><p>The script is a wrapper around <strong>opencv_createsamples</strong>. As mentioned in the OpenCV documentation —</p><p>“<strong>opencv_createsamples</strong>
 is used to prepare a training dataset of positive and test samples. 
opencv_createsamples produces dataset of positive samples in a format 
that is supported by both opencv_haartraining and opencv_traincascade 
applications. The output is a file with *.vec extension, it is a binary 
format which contains images.”</p></li><li>Use <strong>mergevec.py</strong> to merge .vec files into samples.vec like this:<div><div id="highlighter_429892" class="syntaxhighlighter  bash"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">python .</code><code class="bash plain">/tools/mergevec</code><code class="bash plain">.py -</code><code class="bash functions">v</code> <code class="bash plain">samples/ -o samples.vec</code></div></div></td></tr></tbody></table></div></div></li></ol></ol><h3>Run Training Scripts</h3><p>The
 training commands for LBP and Haar cascade training are provided below.
 We trained on a machine with 64 GB RAM, reduce the values of 
precalcValBufSize and precalcIdxBufsize to 1024 if your machine hangs.</p><h4>Training command for Local Binary Patterns (LBP) cascade</h4><p>LBP is much faster than Haar but is less accurate. You can train using the following command.</p><div><div id="highlighter_13658" class="syntaxhighlighter  bash"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">opencv_traincascade -data lbp -vec samples.vec -</code><code class="bash functions">bg</code> <code class="bash plain">negatives.txt -numStages 20 -minHitRate 0.999 -maxFalseAlarmRate 0.5 -numPos 4000 -numNeg 7000 -w 40 -h 40 -mode ALL -precalcValBufSize 4096 -precalcIdxBufSize 4096 -featureType LBP</code></div></div></td></tr></tbody></table></div></div><p><strong>Training command for HAAR cascade</strong><br>
 Haar cascades take a long time to train, but are definitely more 
accurate. You can train a Haar cascade using the following command.</p><div><div id="highlighter_485840" class="syntaxhighlighter  bash"><table cellspacing="0" cellpadding="0" border="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="bash plain">opencv_traincascade -data haar -vec samples.vec -</code><code class="bash functions">bg</code> <code class="bash plain">negatives.txt -numStages 20 -minHitRate 0.999 -maxFalseAlarmRate 0.5 -numPos 4000 -numNeg 7000 -w 40 -h 40 -mode ALL -precalcValBufSize 4096 -precalcIdxBufSize 4096</code></div></div></td></tr></tbody></table></div></div><h2>Eye Detector Results</h2><p>Our typical results look like the one shown below.</p><p><a href="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-example.jpg"><img class="aligncenter size-medium wp-image-3403" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/eye-detection-example.jpg" alt="Eye Detection Example" srcset="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-example.jpg 600w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-example-300x94.jpg 300w" sizes="(max-width: 600px) 100vw, 600px"></a></p><p>On
 such clean images, OpenCV would give similar results. Where we shine 
are difficult examples as shown below. The OpenCV eye detector shows a 
false positive.</p><p><a href="https://www.learnopencv.com/wp-content/uploads/2017/01/opencv-eye-detection-false-positive.jpg"><img class="aligncenter size-medium wp-image-3406" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/opencv-eye-detection-false-positive.jpg" alt="" srcset="https://www.learnopencv.com/wp-content/uploads/2017/01/opencv-eye-detection-false-positive.jpg 858w, https://www.learnopencv.com/wp-content/uploads/2017/01/opencv-eye-detection-false-positive-300x117.jpg 300w, https://www.learnopencv.com/wp-content/uploads/2017/01/opencv-eye-detection-false-positive-768x299.jpg 768w" sizes="(max-width: 858px) 100vw, 858px" width="600"></a></p><p>In contrast, we do much better</p><p><a href="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-better-than-opencv.jpg"><img class="aligncenter size-medium wp-image-3407" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/eye-detection-better-than-opencv.jpg" alt="" srcset="https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-better-than-opencv.jpg 858w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-better-than-opencv-300x117.jpg 300w, https://www.learnopencv.com/wp-content/uploads/2017/01/eye-detection-better-than-opencv-768x299.jpg 768w" sizes="(max-width: 858px) 100vw, 858px" width="600"></a></p><p>Here is side by side comparison on a video</p><div class="video-container" style="margin-bottom:20px;"> <iframe src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/5fCZHlMwpgM.html" allow="autoplay; encrypted-media" allowfullscreen="" width="500" height="281" frameborder="0"></iframe></div><h2 id="download">Subscribe &amp; Download Code</h2><p>If
 you liked this article and would like to download code (C++ and Python)
 and example images used in others posts of this blog, please <a href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">subscribe</a> to our newsletter. You will also receive a free <a href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">Computer Vision Resource</a>
 guide. In our newsletter we share OpenCV tutorials and examples written
 in C++/Python, and Computer Vision and Machine Learning algorithms and 
news.</p><p><a href="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" target="_blank" data-leadbox="https://bigvisionllc.leadpages.net/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-leadbox-id="143948b73f72a2:173c9390c346dc">Subscribe Now</a></p></div><footer class="entry-footer"><p class="entry-meta"><span class="entry-categories">Filed Under: <a href="https://www.learnopencv.com/category/application/" rel="category tag">Application</a>, <a href="https://www.learnopencv.com/category/how-to/" rel="category tag">how-to</a>, <a href="https://www.learnopencv.com/category/object-detection/" rel="category tag">Object Detection</a>, <a href="https://www.learnopencv.com/category/performance/" rel="category tag">Performance</a>, <a href="https://www.learnopencv.com/category/tutorial/" rel="category tag">Tutorial</a></span> <span class="entry-tags">Tagged With: <a href="https://www.learnopencv.com/tag/eye-detector/" rel="tag">Eye Detector</a>, <a href="https://www.learnopencv.com/tag/haar/" rel="tag">haar</a>, <a href="https://www.learnopencv.com/tag/lbp/" rel="tag">lbp</a></span></p></footer></article><div id="disqus_thread"><div id="dcl_btn_container"> <button id="dcl_comment_btn" class=""> Load Comments </button></div></div></main><aside class="sidebar sidebar-primary widget-area" role="complementary" aria-label="Primary Sidebar" itemscope="" itemtype="https://schema.org/WPSideBar" id="genesis-sidebar-primary"><section id="search-5" class="widget widget_search"><div class="widget-wrap"><form class="search-form" itemprop="potentialAction" itemscope="" itemtype="https://schema.org/SearchAction" method="get" action="https://www.learnopencv.com/" role="search"><label class="search-form-label screen-reader-text" for="searchform-5c481748eabae8.48776536">Search this website</label><input class="search-form-input" itemprop="query-input" name="s" id="searchform-5c481748eabae8.48776536" placeholder="Search this website" type="search"><input class="search-form-submit" value="Search" type="submit"><meta itemprop="target" content="https://www.learnopencv.com/?s={s}"></form></div></section><section id="custom_html-9" class="widget_text widget widget_custom_html"><div class="widget_text widget-wrap"><h4 class="widget-title widgettitle">Join Course</h4><div class="textwidget custom-html-widget"><a href="https://courses.learnopencv.com/p/computer-vision-for-faces"> <img alt="Computer Vision for Faces" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/join-computer-vision-for-faces.png"> </a></div></div></section><section id="custom_html-7" class="widget_text widget widget_custom_html"><div class="widget_text widget-wrap"><h4 class="widget-title widgettitle">Resources</h4><div class="textwidget custom-html-widget"><a href="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/" target="_blank" style="background: #4FAEFD; color: rgb(255, 255, 255); text-decoration: none; font-family: Helvetica, Arial, sans-serif; font-weight: bold; font-size: 16px; line-height: 20px; padding: 10px; display: inline-block; max-width: 300px; border-radius: 5px; text-shadow: rgba(0, 0, 0, 0.25) 0px -1px 1px; box-shadow: 
rgba(255, 255, 255, 0.5) 0px 1px 3px inset, rgba(0, 0, 0, 0.5) 0px 1px 3px;" data-leadbox="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/" data-leadbox-id="143044973f72a2:173c9390c346dc">Download Code (C++ / Python)</a></div></div></section><section id="text-8" class="widget widget_text"><div class="widget-wrap"><h4 class="widget-title widgettitle">Disclaimer</h4><div class="textwidget"><p>This site is not affiliated with OpenCV.org</p></div></div></section><section id="user-profile-4" class="widget user-profile"><div class="widget-wrap"><p><span class="alignleft"><img alt="" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/708995cd13fb5756f6bc418aecb23b78.jpeg" srcset="https://secure.gravatar.com/avatar/708995cd13fb5756f6bc418aecb23b78?s=250&amp;d=mm&amp;r=g 2x" class="avatar avatar-125 photo" width="125" height="125"></span>I
 am an entrepreneur with a love for Computer Vision and Machine Learning
 with a dozen years of experience (and a Ph.D.) in the field.</p><p>In 
2007, right after finishing my Ph.D.,  I co-founded TAAZ Inc. with my 
advisor Dr. David Kriegman and Kevin Barnes. The scalability, and 
robustness of our computer vision and machine learning algorithms have 
been put to rigorous test by more than 100M users who have tried our 
products. <a class="pagelink" href="https://www.learnopencv.com/about/">Read More…</a></p></div></section><section id="recent-posts-6" class="widget widget_recent_entries"><div class="widget-wrap"><h4 class="widget-title widgettitle">Recent Posts</h4><ul><li> <a href="https://www.learnopencv.com/video-stabilization-using-point-feature-matching-in-opencv/">Video Stabilization Using Point Feature Matching in OpenCV</a></li><li> <a href="https://www.learnopencv.com/training-yolov3-deep-learning-based-custom-object-detector/">Training YOLOv3 : Deep Learning based Custom Object Detector</a></li><li> <a href="https://www.learnopencv.com/using-openvino-with-opencv/">Using OpenVINO with OpenCV</a></li><li> <a href="https://www.learnopencv.com/cpu-performance-comparison-of-opencv-and-other-deep-learning-frameworks/">CPU Performance Comparison of OpenCV and other Deep Learning frameworks</a></li><li> <a href="https://www.learnopencv.com/install-opencv-on-android-tiny-and-optimized/">Install OpenCV on Android  : Tiny and Optimized</a></li></ul></div></section></aside></div></div><footer class="site-footer" itemscope="" itemtype="https://schema.org/WPFooter"><div class="wrap"><nav class="nav-footer"></nav><p>Copyright ©&nbsp;2019 · Big Vision LLC</p></div></footer></div><script data-leadbox="143948b73f72a2:173c9390c346dc" data-url="https://bigvisionllc.lpages.co/leadbox/143948b73f72a2%3A173c9390c346dc/5649050225344512/" data-config="%7B%7D" type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/leadbox-1538148152.js"></script> <script data-leadbox="143044973f72a2:173c9390c346dc" data-url="https://bigvisionllc.lpages.co/leadbox/143044973f72a2%3A173c9390c346dc/5720147234914304/" data-config="%7B%7D" type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/leadbox-1538148152.js"></script> <script src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/pa-5bb69d586cee870016000122.js" async=""></script><script>if (document.location.protocol != "https:") {document.location = document.URL.replace(/^http:/i, "https:");}</script><script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/shCore.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/shBrushBash.js"></script> <script type="text/javascript">(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "https://www.learnopencv.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.9b";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "https://www.learnopencv.com/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.9b";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.all();

	// Infinite scroll support
	if ( typeof( jQuery ) !== 'undefined' ) {
		jQuery( function( $ ) {
			$( document.body ).on( 'post-load', function() {
				SyntaxHighlighter.highlight();
			} );
		} );
	}</script> <script type="text/javascript">var countVars = {"disqusShortname":"learnopencv"};
var embedVars = {"disqusConfig":{"integration":"wordpress 3.0.16"},"disqusIdentifier":"3370 https:\/\/www.learnopencv.com\/?p=3370","disqusShortname":"learnopencv","disqusTitle":"Training a better Haar and LBP cascade based Eye Detector using OpenCV","disqusUrl":"https:\/\/www.learnopencv.com\/training-better-haar-lbp-cascade-eye-detector-opencv\/","postId":"3370"};
var dclCustomVars = {"dcl_progress_text":"Loading..."};</script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/embed-click.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/hoverIntent.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/superfish.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/superfish_002.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/skip-links.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/fadeup.js"></script> <script type="text/javascript" src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/wp-embed.js"></script> 


<div style="position: absolute; right: 0px; left: 0px; bottom: 0px; top: 0px; z-index: 2147483646; background: black none repeat scroll 0% 0%; width: 100%; opacity: 0.5; display: none; height: 10201px;"></div><iframe src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/a.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 926px;"></iframe><iframe src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/a_004.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 926px;"></iframe><iframe src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/a_003.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 926px;"></iframe><iframe src="Training%20a%20better%20Haar%20and%20LBP%20cascade%20based%20Eye%20Detector%20using%20OpenCV%20|%20Learn%20OpenCV_fichiers/a_004.html" style="position: absolute; left: 0px; top: 0px; width: 100%; display: none; border: medium none; z-index: 2147483647; height: 926px;"></iframe></body></html>
<!-- Dynamic page generated in 0.393 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2019-01-22 23:27:04 -->